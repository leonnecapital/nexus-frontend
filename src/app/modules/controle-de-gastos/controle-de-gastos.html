<div class="space-y-8">
    <h2 class="text-3xl font-extrabold text-[#001f50]">üßæ Controle e Or√ßamento de Gastos</h2>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        @if (totalDiferenca > (totalPlanejado * 0.1)) {
        <div class="lg:col-span-2 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-md"
            role="alert">
            <p class="font-bold">‚ö†Ô∏è Aten√ß√£o: Desvio Or√ßament√°rio</p>
            <p class="text-sm">O total de gastos realizados ultrapassou o planejado em mais de 10%. **Recomenda√ß√£o:**
                Analisar as categorias de Moradia e Lazer.</p>
        </div>
        } @else if (totalDiferenca < 0) { <div
            class="lg:col-span-2 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-lg shadow-md">
            <p class="font-bold">‚úÖ Excelente Controle!</p>
            <p class="text-sm">Voc√™ est√° **{{formatarMoeda(Math.abs(totalDiferenca))}}** abaixo do or√ßamento planejado
                para o m√™s.</p>
    </div>
    }

    <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-[#5c9afc]">
        <h3 class="text-lg font-semibold text-[#001f50] mb-2">Totais do M√™s</h3>
        <p class="text-sm text-gray-500">Planejado: <span
                class="font-medium text-gray-700">{{formatarMoeda(totalPlanejado)}}</span></p>
        <p class="text-xl font-bold mt-1 text-green-600">
            Realizado: {{formatarMoeda(Math.abs(totalDiferenca))}}
        </p>
        <p class="text-xs mt-2"
            [ngClass]="getDiferencaClass(calcularDiferencaPercentual(totalPlanejado, totalRealizado))">
            Diferen√ßa: {{getDiferencaTexto(calcularDiferencaPercentual(totalPlanejado, totalRealizado))}}
        </p>
    </div>
</div>

<div class="bg-white p-6 rounded-xl shadow-lg grid grid-cols-1 md:grid-cols-3 gap-6">

    <div class="md:col-span-2">
        <h3 class="text-xl font-semibold text-[#001f50] mb-4">Distribui√ß√£o dos Gastos (Realizado)</h3>

        <div class="flex items-center justify-center space-x-8">
            <div class="w-48 h-48 rounded-full border-4 border-white shadow-xl flex-shrink-0"
                [style.background]="getPieChartStyle()">
            </div>

            <div class="space-y-2">
                @for (gasto of gastos; track gasto.id) {
                <div class="flex items-center space-x-2">
                    <span class="w-3 h-3 rounded-full" [ngClass]="gasto.corGrafico"></span>
                    <span class="text-sm text-gray-700">{{gasto.categoria}}
                        ({{(gasto.realizado / totalRealizado * 100) | number:'1.0-1'}}%)
                    </span>
                </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="bg-white p-6 rounded-xl shadow-lg overflow-x-auto">
    <h3 class="text-xl font-semibold text-[#001f50] mb-4">Or√ßamento vs. Gastos Reais</h3>

    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoria
                </th>
                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Planejado
                </th>
                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Realizado
                </th>
                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Diferen√ßa
                    (%)</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Alertas</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            @for (item of gastos; track item.id) {
            @if (item.planejado > 0) {
            <tr class="hover:bg-gray-50 transition duration-150">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-[#001f50]">{{item.categoria}}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 text-right">
                    {{formatarMoeda(item.planejado)}}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-800 text-right">
                    {{formatarMoeda(item.realizado)}}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-right"
                    [ngClass]="getDiferencaClass(calcularDiferencaPercentual(item.planejado, item.realizado))">
                    {{getDiferencaTexto(calcularDiferencaPercentual(item.planejado, item.realizado))}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    @if (calcularDiferencaPercentual(item.planejado, item.realizado) > 20) {
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                        > 20%
                    </span>
                    } @else if (calcularDiferencaPercentual(item.planejado, item.realizado) > 5) {
                    <span
                        class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                        > 5%
                    </span>
                    }
                </td>
            </tr>
            }
            }
        </tbody>
        <tfoot class="bg-gray-100">
            <tr>
                <td class="px-6 py-3 whitespace-nowrap text-base font-bold text-[#001f50]">TOTAIS</td>
                <td class="px-6 py-3 whitespace-nowrap text-base font-bold text-right text-gray-700">
                    {{formatarMoeda(totalPlanejado)}}</td>
                <td class="px-6 py-3 whitespace-nowrap text-base font-bold text-right text-gray-900">
                    {{formatarMoeda(totalRealizado)}}</td>
                <td class="px-6 py-3 whitespace-nowrap text-base font-bold text-right"
                    [ngClass]="getDiferencaClass(calcularDiferencaPercentual(totalPlanejado, totalRealizado))">
                    {{getDiferencaTexto(calcularDiferencaPercentual(totalPlanejado, totalRealizado))}}
                </td>
                <td class="px-6 py-3"></td>
            </tr>
        </tfoot>
    </table>
</div>
</div>